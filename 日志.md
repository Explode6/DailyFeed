# 4/23

试图使用dom4j来解析xml

解析xml应该作为activity还是一个服务呢 （服务✔）

# 4/25

dom4j解析遇到问题，某些xml并不规范，会由于其中出现<0x0e>这样的低位字符而导致无法生成dom4j解析所需的document文件（反序列化）。

解决方案：

- 试图通过捕获错误来将读取方式从通过流生成document变为通过string生成document。 在string生成后，通过replace方法替换所有的低位字符。（似乎不行，除非重新发起一个链接去再次下载）
- 存储XML到本地再处理
- **最终方案！！！！！** 编写FilterInputStreamReader类继承InputStreamReader。 如果出现相关符号，则替换。



成功通过读取字节流转string后使用正则表达式匹配得到xml编码，使得xml能够正确解码。

完成chennel类的填写

# 4/26



所有日期类的XML数据都更改为String类型

完成xml的初步解析 （等待阿鹏修改数据库)



# 4/27

了解MPV架构

M:model 数据库模型、数据处理

P:presenter 从Model获取数据，并且提供给View （纯java类）

V:view 视图



图片在android中的存储改为bytes

对xml的解析目前完成，可以对图片以字节数组的形式存储，需要使用的时候可以转为bitmap。



# 4/28

MVP架构图例：

![MVP架构调用关系](http://www.jcodecraeer.com/uploads/userup/13953/1G020140036-F40-0.png)



创建Callback方法 Callback方法为数据层给presenter层传数据的接口

数据层需要提供的接口：

1. 将DataBaseHelper的api封装

| 接口名 | 接口描述 | 返回值 |
| ------ | -------- | ------ |
|        |          |        |
|        |          |        |



Service 使用Bind 返回 presenter（？）

梳理：

1. 每个界面都需要有相应的MVP吗
2. 如果是的话，service应该在哪里

29号再说吧

# 4/29

Service作为model层，完成所有对数据的操作，并且作为一个独立的进程。

使用AIDL完成进程间通信。



# 4/30

DataService为服务

AidlBinder为控制服务的Binder 继承了ImyAidlInterface.Stub

要在aidl中使用自定义类，需要在自定义类中实现Parcelable接口，并且定义静态final变量 CREATOR，创建类的aidl文件。

在自定义类中，如果要向Parcel传输对象，可以使用writeValue，之后再使用readValue（xxx.class.getClassLoader）获取对象。



在MainActivity中绑定服务后，可以拿到一个继承自IMyAidlInterface.aidl的AidlBinder类对象，这个对象可以操纵服务。



# 5/4

恢复干活

将DataService的Callback更改为参数。目的是使得Callback可以自定义，同时这样设计Callback可以将Callback对象传递到很远的地方。





